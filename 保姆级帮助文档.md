# MRI图像重建平台保姆级使用帮助文档

## 软件概述

本软件是一个功能全面的MRI图像重建与数据处理平台，提供图形化用户界面，让没有编程背景的用户也能轻松使用各种先进的图像重建算法。

## 软件界面导航

软件主界面分为四个主要功能页面，通过左侧的导航按钮切换：
- **传统重建** - 基础的傅里叶变换重建方法
- **压缩感知** - 高级数学优化算法
- **深度学习** - 基于人工智能的重建方法
- **数据处理** - 数据预处理和模型训练工具

## 第一部分：传统重建页面详解

### 页面布局
传统重建页面分为左右两个区域：
- **左侧控制区**：参数设置和操作按钮
- **右侧显示区**：重建结果展示

### 左侧控制区详细说明

#### 1. 传统重建参数标题
- **位置**：页面顶部
- **功能**：标识当前页面功能
- **内容**："传统重建参数"

#### 2. kspace数据文件选择区
- **标签**："kspace数据文件"
- **按钮**："选择文件"
- **功能**：选择包含k空间数据的文件夹
- **操作说明**：
  1. 点击"选择文件"按钮
  2. 在弹出的文件浏览器中选择包含.npy格式k空间数据文件的文件夹
  3. 选择后路径会显示在按钮上方的标签中

#### 3. 采样轨迹数据文件选择区
- **标签**："采样轨迹数据文件（非笛卡尔采样）"
- **按钮**："选择文件"
- **功能**：选择非笛卡尔采样轨迹文件（仅在选择非笛卡尔采样时需要）
- **操作说明**：
  1. 仅当"重建类型"选择"非笛卡尔采样"时才需要
  2. 点击"选择文件"按钮
  3. 选择包含轨迹数据的.npy文件

#### 4. 重建类型选择区
- **标签**："重建类型"
- **下拉框**：包含两个选项
  - "笛卡尔采样"：标准的网格采样数据重建
  - "非笛卡尔采样"：径向、螺旋等非标准采样轨迹数据重建
- **功能**：选择数据的采样类型
- **默认值**："笛卡尔采样"

#### 5. 导出选项
- **复选框**："是否导出原始数据"
- **功能**：控制是否同时保存.npy格式的原始数据文件
- **默认状态**：勾选（导出原始数据）
- **操作说明**：
  - 勾选：同时保存.png图像文件和.npy数据文件
  - 不勾选：只保存.png图像文件

#### 6. 执行重建按钮
- **按钮**："执行重建"
- **功能**：开始执行图像重建过程
- **操作说明**：
  1. 确保已选择k空间数据文件
  2. 如需要，选择轨迹文件
  3. 设置重建类型和导出选项
  4. 点击"执行重建"按钮
  5. 在弹出的对话框中选择输出文件夹
  6. 等待重建完成，结果会显示在右侧区域

### 右侧显示区
- **标题**："重建图像展示："
- **功能**：显示重建完成的图像结果
- **显示内容**：重建后的MRI图像，支持放大、缩小、移动等操作

## 第二部分：压缩感知重建页面详解

### 页面布局
压缩感知重建页面同样分为左右两个区域：
- **左侧控制区**：参数设置和操作按钮
- **右侧显示区**：重建结果展示和参数表格

### 左侧控制区详细说明

#### 1. 压缩感知重建参数标题
- **位置**：页面顶部
- **功能**：标识当前页面功能
- **内容**："压缩感知重建参数"

#### 2. kspace降采样数据文件选择区
- **标签**："kspace降采样数据文件"
- **按钮**："选择文件"
- **功能**：选择包含欠采样k空间数据的文件夹
- **操作说明**：
  1. 点击"选择文件"按钮
  2. 选择包含欠采样.npy文件的文件夹
  3. 支持批量处理多个文件

#### 3. 采样掩码/轨迹数据文件选择区
- **标签**："采样掩码/轨迹数据文件"
- **按钮**："选择文件"
- **功能**：选择对应的采样掩码或轨迹文件
- **操作说明**：
  1. 点击"选择文件"按钮
  2. 选择对应的.npy格式掩码或轨迹文件

#### 4. 重建算法选择区
- **标签**："重建算法"
- **下拉框**：包含四个选项
  - "0-总变分（TV）"：基于全变分正则化的ADMM算法
  - "1-小波变换（L1最小化）"：基于小波稀疏性的ISTA算法
  - "2-非均匀（小波变换）"：适用于非笛卡尔采样的小波算法
  - "3-总变分（支持GPU加速）"：GPU加速版本的TV算法
- **功能**：选择要使用的压缩感知重建算法
- **默认值**："0-总变分（TV）"

#### 5. 算法参数设置区
根据选择的不同算法，右侧会显示对应的参数设置表格：

##### 算法0和算法3（总变分）参数表
- **n_iter**：迭代数，默认值50，控制算法迭代次数
- **tv_r**：TV权重，默认值10，控制图像平滑程度
- **rho**：ADMM系数，默认值1，控制优化过程严格程度
- **step**：更新步长，默认值0.5，控制每次更新的步长
- **cg_iter**：共轭梯度迭代，默认值3，控制内部优化迭代次数
- **tv_ndim**：维度TV，默认值2，图像维度设置

##### 算法1（小波变换）参数表
- **n_iter**：迭代数，默认值50
- **epsilon**：收敛阈值，默认值0.0001，控制算法停止精度
- **tol**：容差，默认值0.0001，收敛判断容差
- **decfac**：L1衰减因子，默认值0.5，正则化参数衰减速度
- **threshold**：小波阈值，默认值1，小波系数阈值
- **wavelet**：小波类型，默认值"haar"，使用的小波基函数
- **level**：小波分解层数，默认值2，小波分解层数

##### 算法2（非均匀小波）参数表
- **image_size**：图像尺寸，默认值256
- **eps**：收敛阈值，默认值0.01
- **tol**：容差，默认值0.00001
- **L**：Lipschitz常数，默认值0.01
- **lamda**：L1权重，默认值0.1
- **max_iter**：迭代数，默认值80

#### 6. 导出选项
- **复选框**："是否导出原始数据"
- **功能**：控制是否同时保存.npy格式的原始数据文件
- **默认状态**：勾选
- **操作说明**：
  - 勾选：同时保存.png图像文件和.npy数据文件
  - 不勾选：只保存.png图像文件

#### 7. 执行重建按钮
- **按钮**："执行重建"
- **功能**：开始执行压缩感知图像重建过程
- **操作说明**：
  1. 选择欠采样k空间数据文件夹
  2. 选择对应的掩码或轨迹文件
  3. 选择重建算法
  4. 根据需要调整参数表格中的数值
  5. 设置导出选项
  6. 点击"执行重建"按钮
  7. 在弹出的对话框中选择输出文件夹
  8. 等待重建完成，结果会显示在右侧区域

### 右侧显示区
- **标题**："重建图像展示："
- **功能**：显示重建完成的图像结果和参数设置区域

## 第三部分：深度学习重建页面详解

### 页面布局
深度学习重建页面分为左右两个区域：
- **左侧控制区**：参数设置和操作按钮
- **右侧显示区**：重建结果展示

### 左侧控制区详细说明

#### 1. 深度学习重建参数标题
- **位置**：页面顶部
- **功能**：标识当前页面功能
- **内容**："深度学习重建参数"

#### 2. 源文件路径选择区
- **标签**："源文件路径（val/kspace；val/mask）"
- **按钮**："选择文件"
- **功能**：选择包含验证数据的文件夹
- **操作说明**：
  1. 点击"选择文件"按钮
  2. 选择包含val子文件夹的目录
  3. val文件夹内应包含kspace和mask子文件夹

#### 3. 导出结果路径选择区
- **标签**："选择导出结果路径"
- **按钮**："选择文件"
- **功能**：选择重建结果的保存位置
- **操作说明**：
  1. 点击"选择文件"按钮
  2. 选择希望保存结果的文件夹

#### 4. 模型选择区
- **标签**："选择模型"
- **下拉框**：包含四个选项
  - "U-Net"：经典的编码器-解码器结构
  - "MoDL"：基于模型的深度学习
  - "Transformer"：基于注意力机制的模型
  - "ISTA"：基于迭代软阈值的网络
- **功能**：选择要使用的深度学习模型
- **默认值**："U-Net"

#### 5. 导出选项
- **复选框**："是否导出原始数据"
- **功能**：控制是否同时保存.npy格式的原始数据文件
- **默认状态**：勾选
- **操作说明**：
  - 勾选：同时保存.png图像文件和.npy数据文件
  - 不勾选：只保存.png图像文件

#### 6. 执行重建按钮
- **按钮**："执行重建"
- **功能**：开始执行深度学习图像重建过程
- **操作说明**：
  1. 选择源文件路径
  2. 选择导出结果路径
  3. 选择要使用的模型
  4. 设置导出选项
  5. 点击"执行重建"按钮
  6. 等待重建完成，结果会显示在右侧区域

#### 7. 模型说明区域
- **内容**：
  1. U-Net模型支持笛卡尔以及非笛卡尔采样重建，其不需要加载采样掩码数据文件，是端到端的深度学习模型；
  2. 其余模型暂时只支持笛卡尔采样重建，并且另外需要加载采样掩码；

### 右侧显示区
- **标题**："重建图像展示："
- **功能**：显示重建完成的图像结果对比
- **显示内容**：左侧显示欠采样输入图像，右侧显示AI重建结果

## 第四部分：数据处理页面详解

### 页面布局
数据处理页面功能最为丰富，包含多个子功能区域：
- **顶部标题**："数据处理与模型训练"
- **功能区域**：多个数据处理工具按垂直顺序排列

### 功能区域详细说明

#### 1. 初始化数据集
- **标签**："初始化数据集"
- **按钮**："创建数据集路径"
- **功能**：创建标准的深度学习训练数据集结构
- **操作说明**：
  1. 点击"创建数据集路径"按钮
  2. 选择要创建数据集的目录
  3. 程序会自动创建以下结构：
     ```
     dataset/
     ├── train/
     │   ├── full/
     │   ├── undersampled/
     │   └── mask/
     └── val/
         ├── full/
         ├── undersampled/
         └── mask/
     ```

#### 2. 格式转换（FID->PNG）
- **标签**："格式转换（FID->PNG）"
- **按钮组合**：
  - "加载数据"：选择包含FID文件的文件夹
  - "执行转换"：开始格式转换过程
- **功能**：将原始MRI FID数据文件转换为PNG图像格式
- **操作说明**：
  1. 点击"加载数据"按钮选择FID文件夹
  2. 点击"执行转换"按钮开始转换
  3. 转换后的PNG文件会保存在指定位置

#### 3. 数据分组
- **标签**："数据分组(各组进行相应处理)"
- **按钮组合**：
  - "加载数据"：选择要分组的图像文件夹
  - "执行分组"：开始分组过程
- **功能**：将大量图像文件平均分成指定数量的组
- **操作说明**：
  1. 点击"加载数据"按钮选择图像文件夹
  2. 点击"执行分组"按钮开始分组
  3. 程序会提示输入分组数量
  4. 图像会被平均分配到不同组中

#### 4. 批量修改文件名
- **标签**："批量修改文件名"
- **按钮组合**：
  - "加载数据"：选择要重命名的文件夹
  - "执行修改"：开始重命名过程
- **功能**：为文件批量添加后缀并复制到指定目录
- **操作说明**：
  1. 点击"加载数据"按钮选择源文件夹和目标文件夹
  2. 点击"执行修改"按钮开始重命名
  3. 程序会提示输入要添加的后缀
  4. 文件会被重命名并复制到目标文件夹

#### 5. 降采样kspace与mask/traj生成
- **标签**："降采样kspace与mask/traj生成"
- **下拉框**："选择采样类型"，包含六个选项：
  - "相位随机"：相位编码方向随机采样
  - "位置随机"：中心矩形区域保留的随机采样
  - "径向（均匀）"：均匀分布的径向采样
  - "螺旋（均匀）"：均匀分布的螺旋采样
  - "径向（非均匀）"：非均匀分布的径向采样
  - "螺旋（非均匀）"：非均匀分布的螺旋采样
- **参数表格**：根据选择的采样类型显示对应参数
- **按钮组合**：
  - "加载数据"：选择源图像文件夹和输出文件夹
  - "生成unkspace/mask/traj"：开始生成过程
- **功能**：从完整采样图像生成对应的欠采样k空间数据和掩码/轨迹
- **操作说明**：
  1. 选择采样类型
  2. 根据需要调整参数表格中的数值
  3. 点击"加载数据"按钮选择输入和输出文件夹
  4. 点击"生成unkspace/mask/traj"按钮开始生成
  5. 生成的文件会保存在指定的输出文件夹中

#### 6. 划分训练集与验证集
- **标签**："加载数据与训练"
- **输入框**：验证集比例（默认0.75）
- **按钮**："划分训练集与验证集"
- **功能**：从训练集中随机抽取指定比例的数据作为验证集
- **操作说明**：
  1. 选择包含train文件夹的目录
  2. 在输入框中设置验证集比例（如0.75表示75%作为验证集）
  3. 点击"划分训练集与验证集"按钮
  4. 程序会自动移动文件并创建val文件夹

#### 7. 模型训练
- **标签**："选择模型&训练"
- **下拉框**：包含四个选项
  - "U-Net"：训练U-Net模型
  - "MoDL"：训练MoDL模型
  - "Transformer"：训练Transformer模型
  - "ISTA"：训练ISTA-Net模型
- **按钮**："开始训练"
- **功能**：使用准备好的数据集训练深度学习模型
- **操作说明**：
  1. 确保已经创建了标准数据集结构
  2. 选择要训练的模型类型
  3. 点击"开始训练"按钮
  4. 训练过程会在控制台显示进度
  5. 训练完成后模型权重会保存在model文件夹中

### 右侧显示区
- **标题**："图像展示区"
- **功能**：显示数据处理过程中的图像结果
- **显示内容**：根据当前操作显示相应的图像预览

## 使用流程建议

### 新手使用流程
1. **准备数据**：
   - 使用"数据处理"页面的"初始化数据集"功能创建标准文件夹结构
   - 准备完整的MRI图像数据

2. **生成训练数据**：
   - 使用"降采样kspace与mask/traj生成"功能创建欠采样数据
   - 使用"划分训练集与验证集"功能分离训练和验证数据

3. **训练模型**（可选）：
   - 如果需要定制化模型，使用"模型训练"功能训练专属模型

4. **执行重建**：
   - 根据数据类型选择合适的重建页面
   - 传统重建：适用于标准采样数据
   - 压缩感知：适用于欠采样数据，需要掩码文件
   - 深度学习：适用于欠采样数据，效果通常最好

### 高级用户使用流程
1. **快速重建**：
   - 直接使用预训练的深度学习模型进行重建
   - 根据数据特点选择合适的压缩感知算法

2. **模型优化**：
   - 使用自己的数据重新训练模型
   - 调整算法参数以获得最佳效果

3. **批量处理**：
   - 准备好批量数据文件夹
   - 一次性处理大量数据文件

## 常见问题解答

### Q1: 如何选择合适的重建算法？
**A**: 
- 如果数据是完整采样的：使用"传统重建"
- 如果数据是欠采样的：
  - 追求速度：选择"总变分（TV）"算法
  - 追求质量：选择深度学习模型
  - 有GPU：选择GPU加速版本

### Q2: 为什么深度学习重建效果最好？
**A**: 
深度学习模型经过大量数据训练，能够学习到更复杂的图像特征和重建模式，因此通常能获得最佳的重建质量。

### Q3: 参数如何调整？
**A**: 
- 迭代次数：增加可提高质量但会增加时间
- 正则化参数：根据图像噪声水平调整
- 学习率：深度学习中影响训练稳定性

### Q4: 数据格式要求？
**A**: 
- k空间数据：.npy格式的numpy数组
- 图像数据：.png格式的灰度图像
- 掩码/轨迹：.npy格式的numpy数组

### Q5: 如何处理非笛卡尔采样数据？
**A**: 
- 在"传统重建"中选择"非笛卡尔采样"类型
- 在"压缩感知"中选择算法2或算法3
- 需要提供对应的轨迹文件

## 注意事项

1. **文件路径**：避免使用包含中文或特殊字符的路径
2. **内存管理**：处理大图像时注意系统内存使用
3. **GPU支持**：使用GPU加速需要安装相应的CUDA驱动
4. **数据备份**：重要数据请提前备份
5. **参数保存**：建议记录有效的参数设置以便重复使用

## 技术支持

如在使用过程中遇到任何问题，请：
1. 检查数据格式是否正确
2. 确认文件路径是否有效
3. 查看控制台输出的错误信息
4. 联系技术支持团队获取帮助